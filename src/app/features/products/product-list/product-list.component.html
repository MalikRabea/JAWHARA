<!-- Main Container -->
<div class="min-h-screen bg-gray-50">
    <!-- Header Section -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-2">Discover Amazing Products</h1>
                <p class="text-lg text-gray-600">Find the perfect items for your needs</p>
            </div>

            <!-- Search and Controls Bar -->
            <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
                <div class="w-full lg:w-96">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </div>
                        <input type="text"
                            class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                            placeholder="Search products..." [(ngModel)]="filters.searchQuery" (input)="applyFilters()">
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <!-- View mode toggles (desktop) -->
                    <div class="hidden lg:flex items-center rounded-lg border border-gray-300 overflow-hidden">
                        <button class="px-3 py-2 text-sm focus:outline-none hover:bg-gray-50"
                                [class.bg-blue-50]="viewMode==='grid'" [class.text-blue-700]="viewMode==='grid'"
                                (click)="setViewMode('grid')">
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                        </button>
                        <button class="px-3 py-2 text-sm focus:outline-none hover:bg-gray-50 border-l border-gray-300"
                                [class.bg-blue-50]="viewMode==='list'" [class.text-blue-700]="viewMode==='list'"
                                (click)="setViewMode('list')">
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="4" width="18" height="3"/><rect x="3" y="10.5" width="18" height="3"/><rect x="3" y="17" width="18" height="3"/></svg>
                        </button>
                    </div>

                    <button
                        class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 lg:hidden"
                        (click)="toggleFilterSidebar()" [class.bg-blue-50]="isFilterSidebarOpen"
                        [class.text-blue-700]="isFilterSidebarOpen" [class.border-blue-300]="isFilterSidebarOpen">
                        <svg class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"></polygon>
                        </svg>
                        Filters
                    </button>

                    <div class="relative">
                        <select
                            class="appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm font-medium text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            [(ngModel)]="selectedSort" (change)="applySorting()">
                            <option value="popular">Most Popular</option>
                            <option value="newest">Newest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="rating">Highest Rated</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                            <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex gap-8">
            <!-- Filter Sidebar -->
            <div class="hidden lg:block w-72 flex-shrink-0">
                <div class="bg-white rounded-2xl shadow-md border border-gray-200 p-6 sticky top-8">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Filters</h3>
                        <button class="text-sm text-blue-600 hover:text-blue-700 font-medium" (click)="clearFilters()">
                            Reset
                        </button>
                    </div>

                    <div class="space-y-8">
                        <!-- Categories Filter -->
                        <div>
                            <h4 class="text-sm font-semibold text-gray-800 mb-3">Categories</h4>
                            <div class="space-y-2">
                                <!-- Main Categories -->
                                <div *ngFor="let category of getVisibleCategories()" class="space-y-2">
                                    <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition">
                                        <input type="checkbox"
                                            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                            [value]="category" [checked]="filters.categories.includes(category)"
                                            (change)="toggleCategory(category)">
                                        <span class="text-sm text-gray-700 flex-1">{{ category }}</span>
                                        <!-- Expand/Collapse Icon -->
                                        <button *ngIf="isCategorySelected(category)" 
                                            class="p-1 hover:bg-gray-200 rounded transition-colors">
                                            <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                    </label>
                                    
                                    <!-- Subcategories -->
                                    <div *ngIf="isCategorySelected(category)" 
                                         class="ml-6 space-y-1 border-l-2 border-gray-200 pl-3 subcategory-list">
                                        <label *ngFor="let subcategory of getSubcategories(category)"
                                            class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded transition">
                                            <input type="checkbox"
                                                class="h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                                [checked]="isSubcategorySelected(category, subcategory)"
                                                (change)="toggleSubcategory(category, subcategory)">
                                            <span class="text-xs text-gray-600">{{ subcategory }}</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Show More/Less Button -->
                                <button *ngIf="categories.length > maxVisibleCategories"
                                    class="flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 font-medium p-2 transition"
                                    (click)="toggleCategoriesExpansion()">
                                    <span *ngIf="!showAllCategories">
                                        Show {{ getRemainingCategoriesCount() }} more
                                    </span>
                                    <span *ngIf="showAllCategories">Show less</span>
                                    <svg class="w-3 h-3 transition-transform" 
                                         [class.rotate-180]="showAllCategories" 
                                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Rating Filter -->
                        <div>
                            <h4 class="text-sm font-semibold text-gray-800 mb-3">Rating</h4>
                            <div class="space-y-2">
                                <button class="w-full flex items-center justify-between px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
                                        *ngFor="let r of [5,4,3,2,1]" (click)="setRating(r)">
                                    <span class="flex items-center gap-1">
                                        <span *ngFor="let s of [1,2,3,4,5]" class="text-yellow-400" [class.text-gray-300]="s>r">★</span>
                                        <span class="ml-2 text-sm text-gray-700">&amp; up</span>
                                    </span>
                                    <span class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700" [class.bg-blue-50]="filters.rating===r" [class.text-blue-700]="filters.rating===r">{{ r }}</span>
                                </button>
                            </div>
                        </div>

                        <!-- Price Range Filter -->
                        <div>
                            <h4 class="text-sm font-semibold text-gray-800 mb-3">Price Range</h4>
                            <div class="space-y-4">
                                <!-- Min / Max -->
                                <div class="flex items-center gap-2">
                                    <input type="number"
                                        class="w-1/2 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        placeholder="Min" [(ngModel)]="filters.priceRange.min" (input)="applyFilters()">
                                    <span class="text-gray-500">—</span>
                                    <input type="number"
                                        class="w-1/2 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        placeholder="Max" [(ngModel)]="filters.priceRange.max" (input)="applyFilters()">
                                </div>

                                <!-- Range Slider -->
                                <div class="relative">
                                    <input type="range"
                                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                                        min="0" max="1000" [value]="filters.priceRange.max"
                                        (input)="updatePriceRange($event)">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>$0</span>
                                        <span>$1000+</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                     
                        <!-- Clear Filters Button -->
                        <div class="pt-4 border-t border-gray-200">
                            <button
                                class="w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
                                (click)="clearFilters()">
                                Clear All Filters
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Mobile Filter Sidebar -->
            <div class="lg:hidden fixed inset-0 z-50 overflow-hidden filter-sidebar-overlay" 
                 [class.show]="isFilterSidebarOpen">
                <div class="absolute inset-0 bg-black bg-opacity-50" (click)="toggleFilterSidebar()"></div>
                <div class="absolute right-0 top-0 h-full w-80 bg-white shadow-xl filter-sidebar-panel" 
                     [class.show]="isFilterSidebarOpen">
                    <div class="flex items-center justify-between p-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Filters</h3>
                        <button class="p-2 hover:bg-gray-100 rounded-md" (click)="toggleFilterSidebar()">
                            <svg class="h-5 w-5 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4 overflow-y-auto h-full">
                        <!-- Same filter content as desktop sidebar -->
                        <div class="space-y-6">
                            <!-- Categories Filter -->
                            <div>
                                <h4 class="text-sm font-medium text-gray-900 mb-3">Categories</h4>
                                <div class="space-y-2">
                                    <!-- Main Categories -->
                                    <div *ngFor="let category of getVisibleCategories()" class="space-y-2">
                                        <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded-md transition">
                                            <input type="checkbox"
                                                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                                [value]="category" [checked]="filters.categories.includes(category)"
                                                (change)="toggleCategory(category)">
                                            <span class="text-sm text-gray-700 flex-1">{{ category }}</span>
                                            <!-- Expand/Collapse Icon -->
                                            <button *ngIf="isCategorySelected(category)" 
                                                class="p-1 hover:bg-gray-200 rounded transition-colors">
                                                <svg class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                                </svg>
                                            </button>
                                        </label>
                                        
                                        <!-- Subcategories -->
                                        <div *ngIf="isCategorySelected(category)" 
                                             class="ml-6 space-y-1 border-l-2 border-gray-200 pl-3 subcategory-list">
                                            <label *ngFor="let subcategory of getSubcategories(category)"
                                                class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded transition">
                                                <input type="checkbox"
                                                    class="h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                                    [checked]="isSubcategorySelected(category, subcategory)"
                                                    (change)="toggleSubcategory(category, subcategory)">
                                                <span class="text-xs text-gray-600">{{ subcategory }}</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- Show More/Less Button -->
                                    <button *ngIf="categories.length > maxVisibleCategories"
                                        class="flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 font-medium p-2 transition"
                                        (click)="toggleCategoriesExpansion()">
                                        <span *ngIf="!showAllCategories">
                                            Show {{ getRemainingCategoriesCount() }} more
                                        </span>
                                        <span *ngIf="showAllCategories">Show less</span>
                                        <svg class="w-3 h-3 transition-transform" 
                                             [class.rotate-180]="showAllCategories" 
                                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                        <!-- Price Range Filter -->
                            <div>
                                <h4 class="text-sm font-medium text-gray-900 mb-3">Price Range</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-2">
                                        <input type="number"
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            placeholder="Min" [(ngModel)]="filters.priceRange.min"
                                            (input)="applyFilters()">
                                        <span class="text-gray-500">-</span>
                                        <input type="number"
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            placeholder="Max" [(ngModel)]="filters.priceRange.max"
                                            (input)="applyFilters()">
                                    </div>
                                    <div class="px-1">
                                        <input type="range"
                                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                            min="0" max="1000" [value]="filters.priceRange.max"
                                            (input)="updatePriceRange($event)">
                                    </div>
                                </div>
                            </div>

                       

                        <!-- Rating Filter -->
                        <div>
                            <h4 class="text-sm font-medium text-gray-900 mb-3">Rating</h4>
                            <div class="space-y-2">
                                <button class="w-full flex items-center justify-between px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
                                        *ngFor="let r of [5,4,3,2,1]" (click)="setRating(r)">
                                    <span class="flex items-center gap-1">
                                        <span *ngFor="let s of [1,2,3,4,5]" class="text-yellow-400" [class.text-gray-300]="s>r">★</span>
                                        <span class="ml-2 text-sm text-gray-700">&amp; up</span>
                                    </span>
                                    <span class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700" [class.bg-blue-50]="filters.rating===r" [class.text-blue-700]="filters.rating===r">{{ r }}</span>
                                </button>
                            </div>
                        </div>

                         

                            <!-- Clear Filters -->
                            <div class="pt-4 border-t border-gray-200">
                                <button
                                    class="w-full px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    (click)="clearFilters()">
                                    Clear All Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Grid -->
                <div class="flex-1">
                <!-- Results Header -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-4">
                        <span class="text-sm text-gray-600">{{ filteredProducts.length }} products found</span>
                        <span class="text-sm text-gray-500">Sorted by {{ getSortLabel() }}</span>
                    </div>

                </div>

                    <!-- Applied Filters Chips -->
                    <div *ngIf="hasActiveFilters()" class="flex flex-wrap items-center gap-2 mb-6">
                        <span *ngFor="let c of filters.categories" class="inline-flex items-center gap-1 px-3 py-1 text-xs rounded-full bg-blue-50 text-blue-700 border border-blue-200">
                            {{ c }}
                            <button class="ml-1 hover:text-blue-900" (click)="removeCategoryFilter(c)">✕</button>
                        </span>
                        <span *ngFor="let b of filters.brands" class="inline-flex items-center gap-1 px-3 py-1 text-xs rounded-full bg-green-50 text-green-700 border border-green-200">
                            {{ b }}
                            <button class="ml-1 hover:text-green-900" (click)="removeBrandFilter(b)">✕</button>
                        </span>
                        <span *ngIf="filters.searchQuery" class="inline-flex items-center gap-1 px-3 py-1 text-xs rounded-full bg-gray-100 text-gray-700 border border-gray-300">
                            "{{ filters.searchQuery }}"
                            <button class="ml-1 hover:text-gray-900" (click)="clearSearchQuery()">✕</button>
                        </span>
                        <span *ngIf="filters.rating>0" class="inline-flex items-center gap-1 px-3 py-1 text-xs rounded-full bg-yellow-50 text-yellow-700 border border-yellow-200">
                            {{ filters.rating }}★ &amp; up
                            <button class="ml-1 hover:text-yellow-900" (click)="clearRatingFilter()">✕</button>
                        </span>
                        <span *ngIf="!(filters.priceRange.min===0 && filters.priceRange.max===1000)" class="inline-flex items-center gap-1 px-3 py-1 text-xs rounded-full bg-purple-50 text-purple-700 border border-purple-200">
                            {{ filters.priceRange.min | currency }} - {{ filters.priceRange.max | currency }}
                            <button class="ml-1 hover:text-purple-900" (click)="clearPriceRange()">✕</button>
                        </span>
                        <button class="text-xs text-blue-600 hover:text-blue-700 font-medium ml-2" (click)="clearFilters()">Clear all</button>
                    </div>

                <!-- Loading State Skeletons -->
                <div *ngIf="isLoading">
                    <!-- Desktop grid skeleton -->
                    <div class="hidden lg:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6">
                        <div *ngFor="let s of skeletonItems" class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                            <div class="skeleton skeleton-image mb-4"></div>
                            <div class="space-y-2">
                                <div class="skeleton skeleton-line lg w-2/3"></div>
                                <div class="skeleton skeleton-line"></div>
                                <div class="skeleton skeleton-line sm w-1/2"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Mobile list skeleton -->
                    <div class="lg:hidden space-y-4">
                        <div *ngFor="let s of skeletonItems" class="bg-white rounded-lg shadow-sm border border-gray-200 p-3">
                            <div class="flex gap-3">
                                <div class="skeleton w-32 h-32 rounded-md"></div>
                                <div class="flex-1 space-y-2">
                                    <div class="skeleton skeleton-line w-2/3"></div>
                                    <div class="skeleton skeleton-line"></div>
                                    <div class="skeleton skeleton-line sm w-1/2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Grid View (Desktop Only) -->
                <div *ngIf="!isLoading && viewMode === 'grid'"
                    class="hidden lg:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6">
                    <div *ngFor="let product of displayedProducts"
                        class="group bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200">

                        <!-- Product Image -->
                        <div class="relative aspect-square overflow-hidden">
                            <img [src]="product.image" [alt]="product.name" loading="lazy"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200">
                            <div class="absolute top-3 left-3 flex flex-col gap-2">
                                <span *ngIf="product.isNew"
                                    class="bg-green-500 text-white text-xs font-medium px-2 py-1 rounded-full">New</span>
                                <span *ngIf="product.discount"
                                    class="bg-red-500 text-white text-xs font-medium px-2 py-1 rounded-full">-{{
                                    product.discount }}%</span>
                            </div>
                            <div
                                class="absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                <button
                                    class="p-2 bg-white rounded-full shadow-md hover:bg-gray-50 transition-colors duration-200"
                                    [class.text-red-500]="isInWishlist(product)"
                                    [class.text-gray-600]="!isInWishlist(product)" 
                                    (click)="toggleWishlist(product, $event)">
                                    <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path
                                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                                        </path>
                                    </svg>
                                </button>
                                <button
                                    class="p-2 bg-white rounded-full shadow-md hover:bg-gray-50 transition-colors duration-200 text-gray-600"
                                    (click)="quickView(product)">
                                    <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Product Info -->
                        <div class="p-4">
                            <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">{{ product.category }}</div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">{{ product.name }}</h3>
                            <p class="text-sm text-gray-600 mb-3 line-clamp-2">{{ product.description }}</p>

                            <!-- Rating -->
                            <div class="flex items-center gap-2 mb-3">
                                <div class="flex items-center">
                                    <span *ngFor="let star of [1,2,3,4,5]" class="text-yellow-400 text-sm"
                                        [class.text-gray-300]="star > Math.floor(product.rating)">★</span>
                                </div>
                                <span class="text-sm text-gray-600">{{ product.rating }} ({{ product.reviewCount
                                    }})</span>
                            </div>

                            <!-- Price -->
                            <div class="flex items-center gap-2 mb-4">
                                <span class="text-xl font-bold text-gray-900">{{ product.price|currency }}</span>
                                <span *ngIf="product.originalPrice" class="text-sm text-red-500 line-through">{{
                                    product.originalPrice|currency }}</span>
                            </div>

                            <!-- Add to Cart Button -->
                            <button
                                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 flex items-center justify-center gap-2"
                                (click)="addToCart(product, $event)">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                </svg>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Desktop List View -->
                <div *ngIf="!isLoading && viewMode === 'list'" class="hidden lg:block space-y-4">
                    <div *ngFor="let product of displayedProducts" class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200">
                        <div class="flex">
                            <div class="w-40 h-40 overflow-hidden">
                                <img [src]="product.image" [alt]="product.name" loading="lazy" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1 p-4">
                                <div class="flex items-start justify-between">
                                    <div>
                                        <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">{{ product.category }}<span *ngIf="product.subCategory"> • {{ product.subCategory }}</span></div>
                                        <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ product.name }}</h3>
                                        <p class="text-sm text-gray-600 mb-2 line-clamp-2">{{ product.description }}</p>
                                        <div class="flex items-center gap-2 mb-2">
                                            <div class="flex items-center">
                                                <span *ngFor="let star of [1,2,3,4,5]" class="text-yellow-400 text-sm" [class.text-gray-300]="star > Math.floor(product.rating)">★</span>
                                            </div>
                                            <span class="text-sm text-gray-600">{{ product.rating }} ({{ product.reviewCount }})</span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-gray-900">{{ product.price|currency }}</div>
                                        <div *ngIf="product.originalPrice" class="text-sm text-red-500 line-through">{{ product.originalPrice|currency }}</div>
                                    </div>
                                </div>
                                <div class="mt-3 flex items-center gap-2">
                                    <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            (click)="addToCart(product, $event)">Add to Cart</button>
                                    <button class="px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
                                            [class.text-red-500]="isInWishlist(product)"
                                            (click)="toggleWishlist(product, $event)">
                                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                    </button>
                                    <button class="px-3 py-2 border border-gray-300 rounded-md hover:bg-gray-50" (click)="quickView(product)">Quick View</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Products (Always List View) -->
                <div *ngIf="!isLoading" class="lg:hidden space-y-4">
                    <div *ngFor="let product of displayedProducts"
                        class="group bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200">

                        <!-- Flex Row: Image Left | Content Right -->
                        <div class="flex gap-3 p-3">

                            <!-- Product Image -->
                            <div class="relative w-32 h-32 sm:w-40 sm:h-40 flex-shrink-0 overflow-hidden rounded-md">
                                <img [src]="product.image" [alt]="product.name" loading="lazy"
                                    class="w-full h-full object-cover object-center group-hover:scale-105 transition-transform duration-200">

                                <!-- Badges -->
                                <div class="absolute top-3 left-3 flex flex-col gap-2">
                                    <span *ngIf="product.isNew"
                                        class="bg-green-500 text-white text-xs font-medium px-2 py-1 rounded-full">New</span>
                                    <span *ngIf="product.discount"
                                        class="bg-red-500 text-white text-xs font-medium px-2 py-1 rounded-full">-{{
                                        product.discount }}%</span>
                                </div>
                            </div>

                            <!-- Product Info -->
                            <div class="flex-1 flex flex-col justify-between">

                                <!-- Top Content -->
                                <div>
                                    <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">{{ product.category
                                        }}</div>
                                    <h3 class="text-base font-semibold text-gray-900 mb-1 line-clamp-1">{{ product.name
                                        }}</h3>
                                    <p class="text-xs text-gray-600 mb-2 line-clamp-2">{{ product.description }}</p>

                                    <!-- Rating -->
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="flex items-center">
                                            <span *ngFor="let star of [1,2,3,4,5]" class="text-yellow-400 text-sm"
                                                [class.text-gray-300]="star > Math.floor(product.rating)">★</span>
                                        </div>
                                        <span class="text-xs text-gray-600">{{ product.rating }} ({{ product.reviewCount
                                            }})</span>
                                    </div>

                                    <!-- Price -->
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-lg font-bold text-gray-900">{{ product.price|currency }}</span>
                                        <span *ngIf="product.originalPrice"
                                            class="text-sm text-red-500 line-through">{{ product.originalPrice|currency }}</span>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="flex gap-2 mt-2">
                                    <!-- Add to Cart -->
                                    <button
                                        class="flex-1 bg-blue-600 text-white py-2 px-3 rounded-md hover:bg-blue-700 focus:outline-none 
                          focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 flex items-center justify-center"
                                        (click)="addToCart(product, $event)">
                                        <svg class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <circle cx="9" cy="21" r="1"></circle>
                                            <circle cx="20" cy="21" r="1"></circle>
                                            <path d="M1 1h4l2.68 13.39a2 2 0 0 
                         0 2 1.61h9.72a2 2 0 0 0 
                         2-1.61L23 6H6"></path>
                                        </svg>
                                        Add to Cart
                                    </button>

                                    <!-- Wishlist -->
                                    <button
                                        class="p-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200 flex items-center justify-center"
                                        [class.text-red-500]="isInWishlist(product)"
                                        [class.border-red-500]="isInWishlist(product)"
                                        [class.bg-red-50]="isInWishlist(product)"
                                        [class.text-gray-600]="!isInWishlist(product)" 
                                        (click)="toggleWishlist(product, $event)"
                                        [title]="isInWishlist(product) ? 'Remove from Wishlist' : 'Add to Wishlist'">
                                        <svg class="h-5 w-5" [attr.fill]="isInWishlist(product) ? 'currentColor' : 'none'"
                                            stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                            <path
                                                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                                            </path>
                                        </svg>
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>


                <!-- Empty State -->
                <div *ngIf="!isLoading && filteredProducts.length === 0"
                    class="flex flex-col items-center justify-center py-12">
                    <div class="w-16 h-16 text-gray-400 mb-4">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">No products found</h3>
                    <p class="text-gray-600 mb-4">Try adjusting your filters or search terms</p>
                    <button
                        class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        (click)="clearFilters()">
                        Clear Filters
                    </button>
                </div>

                <!-- Pagination -->
                <div *ngIf="!isLoading && filteredProducts.length > 0" class="flex items-center justify-center mt-8">
                    <nav class="flex items-center gap-2">
                        <button
                            class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                            [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="15,18 9,12 15,6"></polyline>
                            </svg>
                            <span class="ml-1">Previous</span>
                        </button>

                        <div class="flex items-center gap-1">
                            <button *ngFor="let page of getPageNumbers()"
                                class="px-3 py-2 text-sm font-medium rounded-md"
                                [class.bg-blue-600]="page === currentPage" [class.text-white]="page === currentPage"
                                [class.bg-white]="page !== currentPage" [class.text-gray-700]="page !== currentPage"
                                [class.border]="page !== currentPage" [class.border-gray-300]="page !== currentPage"
                                [class.hover:bg-gray-50]="page !== currentPage" (click)="goToPage(page)">
                                {{ page }}
                            </button>
                        </div>

                        <button
                            class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                            [disabled]="currentPage === getTotalPages()" (click)="goToPage(currentPage + 1)">
                            <span class="mr-1">Next</span>
                            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="9,18 15,12 9,6"></polyline>
                            </svg>
                        </button>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>